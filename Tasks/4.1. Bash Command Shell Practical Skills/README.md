
    Домашнее задание к занятию "4.1. Командная оболочка Bash: Практические навыки"

   1. Обязательная задача 1
      Есть скрипт:

   a=1
   b=2
   c=a+b
   d=$a+$b
   e=$(($a+$b))
   Какие значения переменным c,d,e будут присвоены? Почему?

   Решение:

   Переменная	Значение	Обоснование
   
   c	          a+b	    Переменной с присвоен только (a+b)
   
   d	          1+2	    Если использовать $, то вместо переменных подставятся их значения. 
                            По умолчанию переменные - это строки по-этому арифметические операции не выполняться.
   
   e	          3         При использовании: $(()), внутри неё выполниться арифметические операции.


   2. На нашем локальном сервере упал сервис и мы написали скрипт, который постоянно проверяет его доступность,
      записывая дату проверок до тех пор, пока сервис не станет доступным (после чего скрипт должен завершиться).
      В скрипте допущена ошибка, из-за которой выполнение не может завершиться, при этом место на Жёстком Диске
      постоянно уменьшается. Что необходимо сделать, чтобы его исправить:

   while ((1==1)
   do
   	   curl https://localhost:4757
	   if (($? != 0))
	   then
		   date >> curl.log
	   fi
   done
   
   Ваш скрипт:

   #!/usr/bin/env bash
   while ((1==1))
   do
           curl https://localhost:4757
           if (($? != 0))
           then
                   date >> curl.log
           else
                   exit
           fi
           sleep 1
   done
   
   3. Необходимо дописать скрипт из предыдущего задания так, чтобы он выполнялся до тех пор, пока один из узлов не
      окажется недоступным. Если любой из узлов недоступен - IP этого узла пишется в файл error, скрипт прерывается.

   Ваш скрипт:
 
   #!/usr/bin/env bash

   vagrant@vagrant:$ nano script_2.sh   

   hostsip=(10.0.2.2 10.5.5.15 192.168.0.1)
   for h in ${hostsip[@]}
   do
       for i in {1..5}
       do
               curl -s --connect-timeout 2 http://$h:80 > /dev/null
               if (($? != 0))
               then
                  echo $(date) " | Host " $h " недоступен по порту 80"  >> hostlog.log
               else
                  echo $(date)" | Host " $h " доступен по порту 80"  >> hostlog.log
               fi
              sleep 1
       done
   done
   
   vagrant@vagrant:$ chmod +x script_2.sh
   vagrant@vagrant:$ ./script_2.sh
   vagrant@vagrant:$ less hostlog.log
   
   Thu 04 Aug 2022 07:49:29 AM UTC  | Host  10.0.2.2  недоступен по порту 80
   Thu 04 Aug 2022 07:49:32 AM UTC  | Host  10.0.2.2  недоступен по порту 80
   Thu 04 Aug 2022 07:49:35 AM UTC  | Host  10.0.2.2  недоступен по порту 80
   Thu 04 Aug 2022 07:49:38 AM UTC  | Host  10.0.2.2  недоступен по порту 80
   Thu 04 Aug 2022 07:49:41 AM UTC  | Host  10.0.2.2  недоступен по порту 80
   Thu 04 Aug 2022 07:49:44 AM UTC  | Host  10.5.5.15  недоступен по порту 80
   Thu 04 Aug 2022 07:49:47 AM UTC  | Host  10.5.5.15  недоступен по порту 80
   Thu 04 Aug 2022 07:49:50 AM UTC  | Host  10.5.5.15  недоступен по порту 80
   Thu 04 Aug 2022 07:49:53 AM UTC  | Host  10.5.5.15  недоступен по порту 80
   Thu 04 Aug 2022 07:49:56 AM UTC  | Host  10.5.5.15  недоступен по порту 80
   Thu 04 Aug 2022 07:49:57 AM UTC | Host  192.168.0.1  доступен по порту 80
   Thu 04 Aug 2022 07:49:58 AM UTC | Host  192.168.0.1  доступен по порту 80
   Thu 04 Aug 2022 07:49:59 AM UTC | Host  192.168.0.1  доступен по порту 80
   Thu 04 Aug 2022 07:50:00 AM UTC | Host  192.168.0.1  доступен по порту 80
   Thu 04 Aug 2022 07:50:01 AM UTC | Host  192.168.0.1  доступен по порту 80
   hostlog.log (END)
   
   4. Необходимо дописать скрипт из предыдущего задания так, чтобы он выполнялся до тех пор, пока один из узлов не
      окажется недоступным. Если любой из узлов недоступен - IP этого узла пишется в файл error, скрипт прерывается.

   Ваш скрипт:

   vagrant@vagrant:$ nano script3.sh
   
   #!/usr/bin/env bash
   hostsip=(10.0.2.2 10.5.5.15 192.168.0.1)
   while ((1==1))
   do
     for h in ${hostsip[@]}
     do
           curl -s --connect-timeout 2 http://$h:80 > /dev/null
           if (($? != 0))
           then
                   echo $(date) " | Error | Host " $h " недоступен по порту 80"  >> hostlog.log
           else
                   exit
           fi
           sleep 1
     done
   done
   
   vagrant@vagrant:$ chmod +x ./script3.sh
   vagrant@vagrant:$ ./script3.sh
   
   Thu 04 Aug 2022 08:22:33 AM UTC  | Error | Host  10.0.2.2  недоступен по порту 80
   Thu 04 Aug 2022 08:22:36 AM UTC  | Error | Host  10.5.5.15  недоступен по порту 80
   hostlog.log (END)

  